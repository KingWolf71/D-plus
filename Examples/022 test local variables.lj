/* Test Local Variable Scoping
   - Variables inside functions are local
   - Variables outside functions are global
   - Functions can read globals
*/

#pragma appname "Local Variable Test"
#pragma decimals 3
#pragma console on
#pragma consolesize "680x740"
#pragma consoleposition "30,50"
#pragma optimizecode on
#pragma ListASM on
#pragma FastPrint on
#pragma RunThreaded on
#pragma ftoi "truncate"
#pragma version on
#pragma modulename on
#pragma PasteToClipboard on
#pragma floattolerance 0.0001
#pragma GlobalStack 1024
#pragma FunctionStack 32
#pragma EvalStack 256
#pragma LocalStack 64
#pragma CreateLog off
#pragma DefaultFPS 32
#pragma ThreadKillWait 1800

print("Testing Local Variable Scoping");
print("");

// Global variables
globalVar = 100;
x = 10;

print("");
print("=== Test 1: Local variables ===");
print("");
print("Before function: globalVar=", globalVar, " x=", x);
print("");

func test1() {
    localVar = 42;      // Local to test1
    x = 999;            // Local x (shadows global x)
    print("Inside test1: localVar=", localVar, " x=", x);
    print("");
    print("Inside test1: globalVar=", globalVar, " (reading global)");
    print("");
    return localVar;
}

result = test1();
print("After function: result=", result);
print("");
print("Global x unchanged: x=", x);
print("");
print("Global globalVar: globalVar=", globalVar);
print("");

print("");
print("=== Test 2: Different functions, same local names ===");
print("");

func test2() {
    localVar = 111;     // Different localVar than test1
    print("test2: localVar=", localVar);
    print("");
    return localVar;
}

func test3() {
    localVar = 222;     // Yet another localVar
    print("test3: localVar=", localVar);
    print("");
    return localVar;
}

r1 = test2();
r2 = test3();
print("test2 returned: ", r1);
print("");
print("test3 returned: ", r2);
print("");

print("");
print("=== Test 3: Parameters are local ===");
print("");

func testParams(a, b) {
    sum = a + b;        // sum is local
    print("testParams: a=", a, " b=", b, " sum=", sum);
    print("");
    return sum;
}

a = 5;  // Global a
b = 7;  // Global b
r3 = testParams(100, 200);
print("After testParams:");
print("");
print("  Global a=", a, " (unchanged)");
print("");
print("  Global b=", b, " (unchanged)");
print("");
print("  Result=", r3);
print("");

print("");
print("=== Test 4: Reading and writing globals ===");
print("");

counter = 0;  // Global counter

func increment() {
    counter = counter + 1;  // First 'counter' is local (write), second is global (read)
    print("Inside increment: counter=", counter, " (local copy)");
    print("");
    return counter;
}

print("Before: global counter=", counter);
print("");
r4 = increment();
print("After: global counter=", counter, " (unchanged)");
print("");
print("Function returned: ", r4);
print("");

print("");
print("=== All Tests Complete ===");
print("");
